# List Migrations Command Specification

The purpose of the `list-migrations` command is to scan a solution for Entity Framework Core migrations and display them in a tree view. This specification outlines the requirements, options, and expected behavior of the `list-migrations` command.

## Assumptions

- The `list-migrations` command assumes that the user has a basic understanding of Entity Framework Core and database migrations.
- The command will be run within the context of a .NET solution that has been properly configured to use Entity Framework Core.
- The command only works with DbContext factories that implement `IDesignTimeDbContextFactory<TContext>`.

## Features

### List Migrations Command (ListMigrationsCommand.cs)

The `list-migrations` command operates in a single mode and displays all migrations found in the solution.

#### Behavior

1. The command builds the solution first.
2. Scans for all DbContexts in the solution by locating `IDesignTimeDbContextFactory<TContext>` implementations.
3. For each detected DbContext:
   - Lists all migrations with their status (Applied/Pending) and timestamp.
4. Displays the results in a tree view format inside a panel.

### Command Line Options

The command supports the following options:

| Option | Description | Required |
|--------|-------------|----------|
| `[scanPath]` | Path to scan for the solution. Defaults to the current directory. Provided as a positional argument. | No |

## Usage Examples

```powershell
# Run from current directory
nabs-migrations list-migrations

# Specify a solution path
nabs-migrations list-migrations ./MySolution
```

## Output Format

The command displays a panel with a tree view showing:

- Solution name at the root
- Projects containing migrations
- DbContexts within each project
- Migrations within each DbContext with status (Applied/Pending) and timestamp

### Example output:

```
??Solution scanned successfully!??????????????????????????????????????????
? SolutionName.sln Migrations                                            ?
? ??? ProjectName.DataMigrations                                         ?
?     ??? Namespace.PrimaryDbContext                                     ?
?     ?   ??? ?????????????????????????????????????????????????????      ?
?     ?       ? InitialCreate  ? Applied ? 22/12/2025 12:00:00 am ?      ?
?     ?       ?????????????????????????????????????????????????????      ?
?     ??? Namespace.SecondaryDbContext                                   ?
?         ??? ?????????????????????????????????????????????????????      ?
?             ? InitialCreate  ? Pending ? 22/12/2025 12:05:00 am ?      ?
?             ?????????????????????????????????????????????????????      ?
??????????????????????????????????????????????????????????????????????????
```

## Testing Process

- The `scanPath` is currently hard coded to the following solution directory for testing purposes: `C:\Dev\nabs-darrel-schreyer\azd-pipelines-azure-infra`.
- The project that contains the migrations is: `AzdPipelinesAzureInfra.DataMigrations`.

### Test Commands

```powershell
# Test scan migrations
nabs-migrations list-migrations
